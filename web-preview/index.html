<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AppleSauce - Preview</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #E5E5EA;
            /* Darker background to make phone pop */
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ios-frame {
            width: 390px;
            height: 844px;
            background: #F6F6F6;
            /* Opera Light BG */
            border-radius: 50px;
            border: 8px solid #333;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            position: relative;
        }

        .screen {
            height: 100%;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            padding-bottom: 100px;
            /* Space for floating dock */
            background: linear-gradient(180deg, #F6F6F6 0%, #FFFFFF 100%);
        }

        .status-bar {
            padding: 14px 26px;
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            font-weight: 600;
            color: #000;
            z-index: 10;
        }

        .nav-bar {
            padding: 10px 24px;
            margin-bottom: 10px;
        }

        .nav-title {
            font-size: 34px;
            font-weight: 800;
            /* Bolder */
            color: #0A0A0A;
            letter-spacing: -0.5px;
        }

        .content {
            flex: 1;
            padding: 0 20px;
        }

        /* Modern Job Card */
        .job-card {
            background: #FFFFFF;
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.6);
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .job-card:active {
            transform: scale(0.98);
        }

        .job-title {
            font-size: 20px;
            font-weight: 700;
            color: #0A0A0A;
            margin-bottom: 6px;
            line-height: 1.2;
        }

        .job-company {
            font-size: 16px;
            color: #666;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .job-details {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 12px;
        }

        .pill {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .pill-salary {
            background: rgba(52, 199, 89, 0.1);
            color: #248A3D;
        }

        .pill-location {
            background: #F2F2F7;
            color: #8E8E93;
        }

        /* Floating Dock Navigation */
        .floating-dock {
            position: absolute;
            bottom: 34px;
            left: 50%;
            transform: translateX(-50%);
            background: #FFFFFF;
            padding: 8px 24px;
            border-radius: 40px;
            display: flex;
            gap: 32px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            z-index: 100;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .tab-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: #5959F3;
            /* Opera Blurple */
            color: white;
            box-shadow: 0 4px 12px rgba(89, 89, 243, 0.3);
        }

        .tab-btn:not(.active) {
            color: #C7C7CC;
        }

        .tab-icon {
            font-size: 20px;
        }

        /* Inputs & Search */
        .search-container {
            margin-bottom: 24px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 16px 20px;
            padding-left: 48px;
            border-radius: 18px;
            border: none;
            background: #FFFFFF;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
            font-size: 16px;
            outline: none;
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.4;
        }

        .upload-area {
            background: #FFFFFF;
            border: 2px dashed #C7C7CC;
            border-radius: 24px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
        }

        .btn-primary {
            width: 100%;
            background: #5959F3;
            color: white;
            border: none;
            padding: 18px;
            border-radius: 18px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(89, 89, 243, 0.25);
            transition: transform 0.1s;
        }

        .btn-primary:active {
            transform: scale(0.97);
        }

        /* Loading */
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #E5E5EA;
            border-top-color: #5959F3;
            border-radius: 50%;
            margin: 20px auto;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <!-- iOS Frame -->
    <div class="ios-frame">
        <div class="status-bar">
            <span>9:41</span>
            <span>6G</span>
        </div>

        <!-- Scrollable Screen Content -->
        <div id="main-scroll" class="screen">
            <!-- Dynamic Content Injected Here -->
            <div id="content-area"></div>
        </div>

        <!-- Floating Dock (Fixed at bottom of frame) -->
        <div class="floating-dock">
            <div class="tab-btn" id="tab-home" onclick="switchTab(0)">
                <div class="tab-icon">üè†</div>
            </div>
            <div class="tab-btn" id="tab-upload" onclick="switchTab(1)">
                <div class="tab-icon">üìÑ</div>
            </div>
            <div class="tab-btn" id="tab-jobs" onclick="switchTab(2)">
                <div class="tab-icon">üíº</div>
            </div>
        </div>
    </div>

    <script src="api.js"></script>
    <script>
        let currentTab = 0;

        // Views as template strings
        const views = {
            home: `
                <div class="nav-bar">
                    <div class="nav-title">Dashboard</div>
                </div>
                <div class="content">
                    <div class="job-card" style="background: linear-gradient(135deg, #5959F3 0%, #9059F3 100%); color: white;">
                        <div style="font-size: 14px; opacity: 0.8; margin-bottom: 8px;">Welcome</div>
                        <div style="font-size: 24px; font-weight: 700; margin-bottom: 20px;">Guest</div>
                        <div style="font-size: 13px; opacity: 0.9; line-height: 1.4;">
                            Connect your account in the iOS app to seeing tracking stats and matched jobs.
                        </div>
                    </div>
                    
                    <h3 style="margin: 24px 0 12px; font-size: 18px; font-weight: 700;">Get Started</h3>
                    <div class="job-card" style="padding: 16px; display:flex; align-items:center; gap: 12px;" onclick="switchTab(1)">
                        <div style="width: 40px; height: 40px; background: #E5E5EA; border-radius: 12px; display:flex; align-items:center; justify-content:center;">üìÑ</div>
                        <div>
                            <div style="font-weight: 600;">Check Resume</div>
                            <div style="font-size: 12px; color: #8E8E93;">Analyze your resume format</div>
                        </div>
                    </div>
                    
                    <div class="job-card" style="padding: 16px; display:flex; align-items:center; gap: 12px;" onclick="switchTab(2)">
                         <div style="width: 40px; height: 40px; background: #E5E5EA; border-radius: 12px; display:flex; align-items:center; justify-content:center;">üîç</div>
                        <div>
                            <div style="font-weight: 600;">Search Jobs</div>
                            <div style="font-size: 12px; color: #8E8E93;">Browse open positions</div>
                        </div>
                    </div>
                </div>
            `,
            upload: `
                <div class="nav-bar">
                    <div class="nav-title">Check Resume</div>
                </div>
                <div class="content">
                    <div class="upload-area" onclick="document.getElementById('file-input').click()">
                        <div style="font-size: 40px; margin-bottom: 12px;">üìÑ</div>
                        <div style="font-weight: 600; margin-bottom: 4px;">Tap to Upload</div>
                        <div style="font-size: 13px; color: #8E8E93;">PDF or DOCX</div>
                    </div>
                    <input type="file" id="file-input" hidden onchange="handleFile(this.files[0])">
                    
                    <div id="upload-result"></div>
                </div>
            `,
            jobs: `
                <div class="nav-bar">
                    <div class="nav-title">Jobs</div>
                </div>
                <div class="content">
                    <div class="search-container">
                        <span class="search-icon">üîç</span>
                        <input type="text" class="search-input" placeholder="Search roles..." onkeydown="if(event.key==='Enter') search(this.value)">
                    </div>
                    <div id="jobs-list">
                        <div style="text-align: center; color: #8E8E93; margin-top: 40px;">Search for a job to see results</div>
                    </div>
                </div>
            `
        };

        function switchTab(index) {
            currentTab = index;
            const content = document.getElementById('content-area');

            // Update Tab UI
            document.querySelectorAll('.tab-btn').forEach((btn, i) => {
                if (i === index) btn.classList.add('active');
                else btn.classList.remove('active');
            });

            // Render View
            if (index === 0) content.innerHTML = views.home;
            if (index === 1) content.innerHTML = views.upload;
            if (index === 2) {
                content.innerHTML = views.jobs;
                const list = document.getElementById('jobs-list');
                if (list && list.innerHTML.includes('Search for a job')) {
                    // search('software developer'); // No auto search to save API calls
                }
            }
        }

        async function search(query) {
            const list = document.getElementById('jobs-list');
            list.innerHTML = '<div class="spinner"></div>';

            try {
                const jobs = await api.searchJobs(query);
                if (jobs.length === 0) {
                    list.innerHTML = '<div style="text-align:center; padding: 20px; color: #8E8E93;">No jobs found</div>';
                    return;
                }

                list.innerHTML = jobs.map(job => `
                    <div class="job-card">
                        <div class="job-title">${job.title}</div>
                        <div class="job-company">${job.company}</div>
                        <div class="job-details">
                            <span class="pill pill-location">${job.location || 'Remote'}</span>
                            ${job.salary ? `<span class="pill pill-salary">${job.salary}</span>` : ''}
                        </div>
                    </div>
                `).join('');

            } catch (e) {
                list.innerHTML = '<div style="text-align:center; color: red;">Error fetching jobs</div>';
            }
        }

        async function handleFile(file) {
            if (!file) return;
            const resArea = document.getElementById('upload-result');
            resArea.innerHTML = '<div class="spinner"></div>';

            // Use public upload
            const data = await api.uploadResumePublic(file);
            if (data) {
                resArea.innerHTML = `
                    <div class="job-card" style="border-left: 4px solid #34C759;">
                        <div style="font-weight:700; margin-bottom:8px;">‚úÖ Parsed Successfully</div>
                        <div style="font-size:13px; color:#666;">${data.filename}</div>
                        <div style="font-size:12px; color:#8E8E93; margin-top:4px;">Guest Mode: Not saved to profile</div>
                    </div>
                `;
            } else {
                resArea.innerHTML = '<div style="color:red; text-align:center;">Upload failed</div>';
            }
        }

        // Init
        switchTab(0);

    </script>
</body>

</html>